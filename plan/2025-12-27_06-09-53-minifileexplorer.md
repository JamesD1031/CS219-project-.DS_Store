# CS219 proj4 — MiniFileExplorer 执行计划

> 需求来源：`project4/04_Mini-version_File_Manager_Development_Project_zh.pdf`（仅以该文档为准，不额外补需求）

## 1. 目标与范围
开发一款基于终端的迷你文件管理器 `MiniFileExplorer`（C++17），支持文档要求的目录切换、文件/目录创建删除、列表展示、信息查询与进阶的搜索/复制移动/目录大小与排序；并提供可编译的工程结构与简洁项目文档。

## 2. 功能清单（逐条映射文档要求）与验收口径

### A) 基础要求（80 分）

#### A1. 目录初始化与切换（25 分）
1) **启动初始化**
   - 需求：启动时默认加载当前工作目录（`getcwd()`），并显示当前目录路径：`Current Directory: <path>`
   - 需求：允许通过命令行参数指定初始目录：`./MiniFileExplorer <dir>`；若目录不存在：提示 `Directory not found: <dir>` 并退出
   - 验收：
     - 直接运行程序：首行输出以 `Current Directory:` 开头，且路径为启动时 CWD
     - 传入存在目录：首行输出为传入目录的绝对路径（或等价规范化路径）
     - 传入不存在目录：输出精确字符串并退出（返回码非 0 或直接结束均可）

2) **目录切换操作（cd）**
   - 需求：`cd [目录路径]` 支持相对路径（`../..`、`./test`）
   - 需求：校验合法性：不存在 → `Invalid directory: [目标路径]`；是文件非目录 → `Not a directory: [目标路径]`
   - 需求：`cd ~` 切换到当前用户主目录
   - 验收：
     - `cd ..` 后 `Current Directory`（或内部状态）变化，后续 `ls` 发生在新目录
     - `cd` 到不存在路径/文件路径时输出精确错误提示
     - `cd ~` 可进入 `$HOME`（Linux/macOS）对应目录

#### A2. 文件/文件夹基础操作（30 分）
1) **创建**
   - 需求：`touch [文件名]` 创建空文件；已存在 → `File already exists: <name>`
   - 需求：`mkdir [文件夹名]` 创建空文件夹；已存在 → `Directory already exists: <name>`
   - 验收：
     - `touch a.txt` 后文件存在且大小为 0
     - `mkdir dir` 后目录存在
     - 对已存在目标输出精确提示且不破坏原文件/目录

2) **删除**
   - 需求：`rm [文件名]` 删除文件；删除前二次确认：`Are you sure to delete <文件名>? (y/n)`；仅输入 `y` 执行
   - 需求：`rmdir [文件夹名]` 删除空文件夹；非空 → `Directory not empty: <name>`；不存在 → `Directory not found: <name>`
   - 验收：
     - 输入 `rm a.txt` 时出现确认提示；输入 `n` 后文件仍存在；输入 `y` 后文件被删除
     - `rmdir` 对空目录成功；对非空目录输出精确提示并不删除

3) **目录内容列表（ls）**
   - 需求：`ls` 列出当前目录所有文件和文件夹；目录名后加 `/`
   - 需求：四列对齐：`名称、类型、大小（字节）、修改时间`
   - 验收：
     - 输出首行为表头：`Name Type Size(B) Modify Time`
     - 目录项以 `xxx/` 形式展示，类型为 `Dir`；文件类型为 `File`
     - 修改时间格式为 `YYYY-MM-DD HH:MM:SS`，列对齐可读

#### A3. 终端交互与信息查询（25 分）
1) **命令交互与帮助**
   - 需求：启动后提示：`Enter command (type 'help' for all commands): `，持续读入命令
   - 需求：`help` 列出所有命令及说明
   - 需求：`exit` 退出并提示 `MiniFileExplorer closed successfully`
   - 验收：
     - 程序可交互循环，未知命令有友好提示（不强制，但建议）
     - `help` 输出包含所有已实现命令与用法
     - `exit` 输出精确字符串并退出

2) **stat 信息查询**
   - 需求：`stat [文件/文件夹名]` 显示：类型、路径、大小（目录为 `-`）、创建/修改/访问时间
   - 需求：目标不存在 → `Target not found: <name>`
   - 需求：缺少参数（仅 `stat`）→ `Missing target: Please enter'stat [name]'`
   - 验收：
     - `stat a.txt` 输出至少包含上述 6 项信息（字段名允许自定义，但信息必须齐）
     - 错误场景输出精确提示

### B) 进阶要求（最高 40 分）

#### B1. search（10 分）
1) 需求：`search [关键词]` 在当前目录及所有子目录递归搜索，名称包含关键词（不区分大小写）
2) 需求：结果展示：
   - `Search results for '<kw>' (<n> items):`
   - 每行：`<path> (File)` / `<path>/ (Dir)`
3) 需求：无结果：`No results found for '<kw>'`
验收：
- 构造多层目录，确保大小写不同仍可匹配；输出数量与路径正确

#### B2. cp / mv（15 分）
1) 需求：`cp [源文件路径] [目标路径]` 复制文件；目标存在同名文件时提示 `File exists in target: Overwrite? (y/n)`；输入 `y` 覆盖
2) 需求：`mv [源文件/文件夹路径] [目标路径]` 移动文件/文件夹；支持重命名
3) 需求：校验：源不存在 → `Source not found`；目标非法 → `Invalid target path`
验收：
- `cp` 复制后内容一致；覆盖提示生效
- `mv` 可移动到新目录、可重命名；目录移动后结构保留
- 非法源/目标输出精确提示

#### B3. du 与 ls 排序（15 分）
1) 需求：`du [文件夹名]` 统计总大小（递归）；单位 KB/MB 自动适配；提示 `Total size of <dir>: <n> KB/MB`
2) 需求：`ls -s` 按大小降序（文件夹按子文件总大小计算，空文件夹最后）
3) 需求：`ls -t` 按修改时间降序（最新在前）；仍保持 4 列对齐格式
验收：
- `du` 对已知数据集输出单位与数值合理（至少满足示例：1024B→1KB，2048000B→2MB）
- `ls -s/-t` 排序满足规则且输出格式不乱

### C) 提交要求（文档）
1) 需求：提供项目文档，包含已实现功能用途与用法
验收：
- `README.md`（或等价文档）包含：构建方式、运行方式、命令清单与示例

## 3. 工程结构设计
建议结构（C++17 + CMake）：
- `CMakeLists.txt`：构建 `MiniFileExplorer`
- `include/`：公共头文件（命令解析、格式化、文件系统工具）
- `src/`：实现（主循环、命令分发、各命令逻辑）
- `scripts/`：可选，放置手工验收脚本（不强制）
- `README.md`：项目文档

## 4. 风险与安全边界（尤其是 rm / rmdir / cp / mv）
1) **破坏性操作确认**：`rm` 必须二次确认且仅 `y` 执行；默认不实现任何 `rm -rf` 或递归删除。
2) **路径合法性校验**：
   - `cd`：存在性与目录性检查
   - `rmdir`：仅空目录可删；非空/不存在给出明确提示
   - `cp/mv`：源存在性、目标父目录存在性、目标路径类型（文件/目录）检查；覆盖仅在明确确认后执行
3) **递归遍历风险**（`search/du/ls -s`）：可能遇到权限拒绝/循环链接等；采用“不跟随符号链接 + 跳过无权限项”的策略，保证程序不中断。
4) **时间字段跨平台差异**：Linux 无真实“创建时间”，可能用 `ctime` 近似；需在实现中说明策略并保证输出稳定。

## 5. 回滚与失败策略（针对破坏性操作）
1) `rm`/覆盖复制：执行前明确提示；用户非 `y` 即取消，默认不改变文件系统。
2) `mv`：优先使用 `rename`（原子、可回滚）；跨设备失败时采用 copy+remove 的退化方案，并在失败时保证“要么源仍在、要么目标完整”（以错误处理为主）。
3) 开发过程回滚：每个功能点独立 git commit；若某条需求实现有误可通过 `git revert <hash>` 单独回滚。

## 6. 验收与测试策略
- 首选：CMake 构建成功，能在临时目录内通过输入脚本进行端到端验证（重定向 stdin）。
- 若无法自动化全部时间相关断言：采用“受限验收”，验证关键输出包含目标字段/关键字，并在 issues notes 中记录限制与人工复查步骤。

